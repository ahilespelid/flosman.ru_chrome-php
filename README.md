# Chrome PHP

[![Latest Stable Version](https://poser.pugx.org/chrome-php/chrome/version)](https://packagist.org/packages/chrome-php/chrome)
[![License](https://poser.pugx.org/chrome-php/chrome/license)](https://packagist.org/packages/chrome-php/chrome)

–≠—Ç–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–∏–≥—Ä–∞—Ç—å—Å—è —Å chrome/chromium –≤ headless —Ä–µ–∂–∏–º–µ —Å PHP.

–ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ!


## –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

- –û—Ç–∫—Ä–æ–π—Ç–µ chrome –±—Ä–∞—É–∑–µ—Ä –∏–ª–∏ –¥—Ä—É–≥–æ–π –Ω–∞ –±–∞–∑–µ chromium –∏–∑ php
- –û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –ø–æ –Ω–∏–º
- –î–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã
- –û—Ü–µ–Ω–∏—Ç–µ javascript –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –°–æ–∑–¥–∞–≤–∞–π—Ç–µ PDF —Å–ª–µ–ø–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
- –≠–º—É–ª–∏—Ä—É–π—Ç–µ –º—ã—à—å
- –≠–º—É–ª–∏—Ä—É–π—Ç–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
- –í—Å–µ–≥–¥–∞ –¥—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫ IDE

–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞!


## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–¢—Ä–µ–±—É–µ—Ç—Å—è PHP 7.4-8.2 –∏ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª chrome / chromium 65+.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ Linux, –Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å macOS –∏ Windows.


## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Å Composer –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ packagist
[chrome-php/chrome](https://packagist.org/packages/chrome-php/chrome):

```bash
$ composer require chrome-php/chrome
```


## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π API –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Chrome, –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü, —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤, –æ–±—Ö–æ–¥–∞ –≤–µ–±-—Å–∞–π—Ç–æ–≤... –∏ –ø–æ—á—Ç–∏ –≤—Å–µ, —á—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å —Å Chrome –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫.
```php
use HeadlessChromium\BrowserFactory;

$browserFactory = new BrowserFactory();

// starts headless chrome
$browser = $browserFactory->createBrowser();

try {
    // creates a new page and navigate to an URL
    $page = $browser->createPage();
    $page->navigate('http://example.com')->waitForNavigation();

    // get page title
    $pageTitle = $page->evaluate('document.title')->getReturnValue();

    // screenshot - Say "Cheese"! üòÑ
    $page->screenshot()->saveToFile('/foo/bar.png');

    // pdf
    $page->pdf(['printBackground' => false])->saveToFile('/foo/bar.pdf');
} finally {
    // bye
    $browser->close();
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥—Ä—É–≥–æ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ Chrome

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ñ–∞–±—Ä–∏–∫–∞ –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ä–µ–¥—ã "CHROME_PATH" –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ Chrome. –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –æ–Ω–∞ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è —É–≥–∞–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª—É –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –≤–∞—à–µ–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "chrome" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —è–≤–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ª—é–±–æ–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –ø–æ –≤–∞—à–µ–º—É –≤—ã–±–æ—Ä—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞. –ù–∞–ø—Ä–∏–º–µ—Ä ``"chromium-browser"``:

```php
use HeadlessChromium\BrowserFactory;

// replace default 'chrome' with 'chromium-browser'
$browserFactory = new BrowserFactory('chromium-browser');
```

### –û—Ç–ª–∞–¥–∫–∞

–°–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–º–µ—Ä –æ—Ç–∫–ª—é—á–∞–µ—Ç headless —Ä–µ–∂–∏–º –¥–ª—è –æ–±–ª–µ–≥—á–µ–Ω–∏—è –æ—Ç–ª–∞–¥–∫–∏

```php
use HeadlessChromium\BrowserFactory;

$browserFactory = new BrowserFactory();

$browser = $browserFactory->createBrowser([
    'headless' => false, // disable headless mode
]);
```

–î—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–ª–∞–¥–∫–∏:

```php
[
    'connectionDelay' => 0.8,            // add 0.8 second of delay between each instruction sent to chrome,
    'debugLogger'     => 'php://stdout', // will enable verbose mode
]
```

–û ``debugLogger``: —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–∞—è —Å—Ç—Ä–æ–∫–∞ —Ä–µ—Å—É—Ä—Å–∞, —Ä–µ—Å—É—Ä—Å –∏–ª–∏ –æ–±—ä–µ–∫—Ç, —Ä–µ–∞–ª–∏–∑—É–µ–º—ã–π 
``LoggerInterface`` –∏–∑ Psr\Log (such as [monolog](https://github.com/Seldaek/monolog)
or [apix/log](https://github.com/apix/log)).


## API

### –§–∞–±—Ä–∏–∫–∞ –±—Ä–∞—É–∑–µ—Ä–æ–≤

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ `createBrowser` –º–µ—Ç–æ–¥–µ, –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—É–¥—É—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω—ã.

```php
use HeadlessChromium\BrowserFactory;

$browserFactory = new BrowserFactory();
$browser = $browserFactory->createBrowser([
    'windowSize'   => [1920, 1000],
    'enableImages' => false,
]);

// this browser will be created without any options
$browser2 = $browserFactory->createBrowser();
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–æ–≤ `setOptions` –∏ `addOptions` –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.

```php
$browserFactory->setOptions([
    'windowSize' => [1920, 1000],
]);

// both browser will have the same 'windowSize' option
$browser1 = $browserFactory->createBrowser();
$browser2 = $browserFactory->createBrowser();

$browserFactory->addOptions(['enableImages' => false]);

// this browser will have both the 'windowSize' and 'enableImages' options
$browser3 = $browserFactory->createBrowser();

$browserFactory->addOptions(['enableImages' => true]);

// this browser will have the previous 'windowSize', but 'enableImages' will be true
$browser4 = $browserFactory->createBrowser();
```

#### –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø—Ü–∏–∏

–í–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ factory:

| –ù–∞–∑–≤–∞–Ω–∏–µ –æ–ø—Ü–∏–∏            | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                                     |
|---------------------------|--------------|------------------------------------------------------------------------------------------------------------------------------|
| `connectionDelay`         | `0`          | –ó–∞–¥–µ—Ä–∂–∫–∞, –ø—Ä–∏–º–µ–Ω—è–µ–º–∞—è –º–µ–∂–¥—É –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π –≤ —Ü–µ–ª—è—Ö –æ—Ç–ª–∞–¥–∫–∏                                                                 |
| `customFlags`             | none         | –ú–∞—Å—Å–∏–≤ —Ñ–ª–∞–≥–æ–≤ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É. –ù–∞–ø—Ä–∏–º–µ—Ä: `['--option1', '--option2=someValue']`.                             |
| `debugLogger`             | `null`       | –°—Ç—Ä–æ–∫–∞ (e.g "php://stdout"), –∏–ª–∏ —Ä–µ—Å—É—Ä—Å, –∏–ª–∏ PSR-3 logger instance –¥–ª—è –ø–µ—á–∞—Ç–∏ –æ—Ç–ª–∞–¥–æ—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.                          |
| `enableImages`            | `true`       | –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.                                                                                            |
| `envVariables`            | none         | –ú–∞—Å—Å–∏–≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—ã –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø—Ä–æ—Ü–µ—Å—Å—É (–ø—Ä–∏–º–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π).                                              |
| `headers`                 | none         | –ú–∞—Å—Å–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤.                                                                                     |
| `headless`                | `true`       | –í–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å headless —Ä–µ–∂–∏–º.                                                                                       |
| `ignoreCertificateErrors` | `false`      | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Chrome —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª –æ—à–∏–±–∫–∏ ssl.                                                                      |
| `keepAlive`               | `false`      | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ `true` —á—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä Chrome –≤ —Ä–∞–±–æ—á–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞.            |
| `noSandbox`               | `false`      | –í–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –±–µ–∑ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥—ã, –ø–æ–ª–µ–∑–Ω—ã–π –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ docker.                                            |
| `noProxyServer`           | `false`      | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä, –≤—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –ø—Ä—è–º—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∫—Å–∏.              |
| `proxyBypassList`         | none         | –ó–∞–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ö–æ—Å—Ç–æ–≤, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –æ–±—Ö–æ–¥–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∫—Å–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.                               |
| `proxyServer`             | none         | –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: `127.0.0.1:8080` (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç).  |
| `sendSyncDefaultTimeout`  | `5000`       | –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–º—Å) –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.                                                       |
| `startupTimeout`          | `30`         | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–ø—É—Å–∫–∞ Chrome –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.                                                                       |
| `userAgent`               | none         | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–≥–µ–Ω—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–æ –≤—Å–µ–º –±—Ä–∞—É–∑–µ—Ä–µ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å–º. –≤ page API).                           |
| `userDataDir`             | none         | –ö–∞—Ç–∞–ª–æ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö Chrome (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø—É—Å—Ç–æ–π –∫–∞—Ç–∞–ª–æ–≥).                              |
| `userCrashDumpsDir`       | none         | –ö–∞—Ç–∞–ª–æ–≥, –≤ –∫–æ—Ç–æ—Ä–æ–º crashpad –¥–æ–ª–∂–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–º–ø—ã (crash reporter –±—É–¥–µ—Ç –≤–∫–ª—é—á–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).                               |
| `windowSize`              | none         | –†–∞–∑–º–µ—Ä –æ–∫–Ω–∞. –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $width, $height - —Å–º–æ—Ç—Ä–∏—Ç–µ —Ç–∞–∫–∂–µ –°—Ç—Ä–∞–Ω–∏—Ü—É::setViewport.                                          |


### –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –ø–æ–∫–∞–∑–∞–Ω–æ, –∫–∞–∫ —Å–æ–≤–º–µ—Å—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä Chrome –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–∞ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∞–±—Ä–∏–∫—É –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Chrome, –ø–æ—Å–ª–µ —á–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º uri –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —ç—Ç–æ–º—É –±—Ä–∞—É–∑–µ—Ä—É –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ.

–°–ª–µ–¥—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã —Å–∫—Ä–∏–ø—Ç–∞ –±—É–¥—É—Ç —Å—á–∏—Ç—ã–≤–∞—Ç—å uri –∏–∑ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞, —á—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —ç–∫–∑–µ–º–ø–ª—è—Ä—É Chrome –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ. –ï—Å–ª–∏ chrome –±—ã–ª –∑–∞–∫—Ä—ã—Ç –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–µ–ª —Å–±–æ–π, –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–Ω–æ–≤–∞.

```php
use \HeadlessChromium\BrowserFactory;
use \HeadlessChromium\Exception\BrowserConnectionFailed;

// path to the file to store websocket's uri
$socket = \file_get_contents('/tmp/chrome-php-demo-socket');

try {
    $browser = BrowserFactory::connectToBrowser($socket);
} catch (BrowserConnectionFailed $e) {
    // The browser was probably closed, start it again
    $factory = new BrowserFactory();
    $browser = $factory->createBrowser([
        'keepAlive' => true,
    ]);

    // save the uri to be able to connect again to browser
    \file_put_contents($socketFile, $browser->getSocketUri(), LOCK_EX);
}
```

### API –±—Ä–∞—É–∑–µ—Ä–∞

#### –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (tab)

```php
$page = $browser->createPage();
```

#### –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (tabs)

```php
$pages = $browser->getPages();
```

#### –ó–∞–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä

```php
$browser->close();
```

### –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, —Å–æ–∑–¥–∞–Ω–Ω—É—é —ç—Ç–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º

```php
$browser->setPagePreScript('// Simulate navigator permissions;
const originalQuery = window.navigator.permissions.query;
window.navigator.permissions.query = (parameters) => (
    parameters.name === 'notifications' ?
        Promise.resolve({ state: Notification.permission }) :
        originalQuery(parameters)
);');
```

### Page API

#### Navigate to an URL

```php
// navigate
$navigation = $page->navigate('http://example.com');

// wait for the page to be loaded
$navigation->waitForNavigation();
```

When using ``$navigation->waitForNavigation()`` you will wait for 30sec until the page event "loaded" is triggered.
You can change the timeout or the event to listen for:

```php
use HeadlessChromium\Page;

// wait 10secs for the event "DOMContentLoaded" to be triggered
$navigation->waitForNavigation(Page::DOM_CONTENT_LOADED, 10000);
```

Available events (in the order they trigger):

- ``Page::DOM_CONTENT_LOADED``: dom has completely loaded
- ``Page::LOAD``: (default) page and all resources are loaded
- ``Page::NETWORK_IDLE``: page has loaded, and no network activity has occurred for at least 500ms

When you want to wait for the page to navigate 2 main issues may occur.
First, the page is too long to load and second, the page you were waiting to be loaded has been replaced.
The good news is that you can handle those issues using a good old try-catch:

```php
use HeadlessChromium\Exception\OperationTimedOut;
use HeadlessChromium\Exception\NavigationExpired;

try {
    $navigation->waitForNavigation()
} catch (OperationTimedOut $e) {
    // too long to load
} catch (NavigationExpired $e) {
    // An other page was loaded
}
```

#### Evaluate script on the page

Once the page has completed the navigation you can evaluate arbitrary script on this page:

```php
// navigate
$navigation = $page->navigate('http://example.com');

// wait for the page to be loaded
$navigation->waitForNavigation();

// evaluate script in the browser
$evaluation = $page->evaluate('document.documentElement.innerHTML');

// wait for the value to return and get it
$value = $evaluation->getReturnValue();
```


Sometimes the script you evaluate will click a link or submit a form, in this case, the page will reload and you
will want to wait for the new page to reload.

You can achieve this by using ``$page->evaluate('some js that will reload the page')->waitForPageReload()``.
An example is available in [form-submit.php](./examples/form-submit.php)

#### Call a function

This is an alternative to ``evaluate`` that allows calling a given function with the given arguments in the page context:

```php
$evaluation = $page->callFunction(
    "function(a, b) {\n    window.foo = a + b;\n}",
    [1, 2]
);

$value = $evaluation->getReturnValue();
```

#### Add a script tag

That's useful if you want to add jQuery (or anything else) to the page:

```php
$page->addScriptTag([
    'content' => file_get_contents('path/to/jquery.js')
])->waitForResponse();

$page->evaluate('$(".my.element").html()');
```

You can also use an URL to feed the src attribute:

```php
$page->addScriptTag([
    'url' => 'https://code.jquery.com/jquery-3.3.1.min.js'
])->waitForResponse();

$page->evaluate('$(".my.element").html()');
```

#### Set the page HTML

You can manually inject html to a page using the ```setHtml``` method.

```php
// Basic
$page->setHtml('<p>text</p>');

// Specific timeout & event
$page->setHtml('<p>text</p>', 10000, Page::NETWORK_IDLE);
```

When a page's HTML is updated, we'll wait for the page to unload. You can specify how long to wait and which event to wait for through two optional parameters. This defaults to 3000ms and the "load" event.

Note that this method will not append to the current page HTML, it will completely replace it.

#### Get the page HTML

You can get the page HTML as a string using the ```getHtml``` method.

```php
$html = $page->getHtml();
```

### Add a script to evaluate upon page navigation

```php
$page->addPreScript('// Simulate navigator permissions;
const originalQuery = window.navigator.permissions.query;
window.navigator.permissions.query = (parameters) => (
    parameters.name === 'notifications' ?
        Promise.resolve({ state: Notification.permission }) :
        originalQuery(parameters)
);');
```

If your script needs the dom to be fully populated before it runs then you can use the option "onLoad":

```php
$page->addPreScript($script, ['onLoad' => true]);
```

#### Set viewport size

This feature allows changing the size of the viewport (emulation) for the current page without affecting the size of
all the browser's pages (see also option ``"windowSize"`` of [BrowserFactory::createBrowser](#options)).

```php
$width = 600;
$height = 300;
$page->setViewport($width, $height)
    ->await(); // wait for the operation to complete
```

#### Make a screenshot

```php
// navigate
$navigation = $page->navigate('http://example.com');

// wait for the page to be loaded
$navigation->waitForNavigation();

// take a screenshot
$screenshot = $page->screenshot([
    'format'  => 'jpeg',  // default to 'png' - possible values: 'png', 'jpeg',
    'quality' => 80,      // only if format is 'jpeg' - default 100
]);

// save the screenshot
$screenshot->saveToFile('/some/place/file.jpg');
```

**Screenshot an area on a page**

You can use the option "clip" to choose an area on a page for the screenshot

```php
use HeadlessChromium\Clip;

// navigate
$navigation = $page->navigate('http://example.com');

// wait for the page to be loaded
$navigation->waitForNavigation();

// create a rectangle by specifying to left corner coordinates + width and height
$x = 10;
$y = 10;
$width = 100;
$height = 100;
$clip = new Clip($x, $y, $width, $height);

// take the screenshot (in memory binaries)
$screenshot = $page->screenshot([
    'clip'  => $clip,
]);

// save the screenshot
$screenshot->saveToFile('/some/place/file.jpg');
```

**Full-page screenshot**

You can also take a screenshot for the full-page layout (not only the viewport) using ``$page->getFullPageClip`` with attribute ``captureBeyondViewport = true``

```php
// navigate
$navigation = $page->navigate('https://example.com');

// wait for the page to be loaded
$navigation->waitForNavigation();

$screenshot = $page->screenshot([
    'captureBeyondViewport' => true,
    'clip' => $page->getFullPageClip(),
    'format' => 'jpeg', // default to 'png' - possible values: 'png', 'jpeg',
]);

// save the screenshot
$screenshot->saveToFile('/some/place/file.jpg');
```

#### Print as PDF

```php
// navigate
$navigation = $page->navigate('http://example.com');

// wait for the page to be loaded
$navigation->waitForNavigation();

$options = [
    'landscape'           => true,             // default to false
    'printBackground'     => true,             // default to false
    'displayHeaderFooter' => true,             // default to false
    'preferCSSPageSize'   => true,             // default to false (reads parameters directly from @page)
    'marginTop'           => 0.0,              // defaults to ~0.4 (must be a float, value in inches)
    'marginBottom'        => 1.4,              // defaults to ~0.4 (must be a float, value in inches)
    'marginLeft'          => 5.0,              // defaults to ~0.4 (must be a float, value in inches)
    'marginRight'         => 1.0,              // defaults to ~0.4 (must be a float, value in inches)
    'paperWidth'          => 6.0,              // defaults to 8.5 (must be a float, value in inches)
    'paperHeight'         => 6.0,              // defaults to 11.0 (must be a float, value in inches)
    'headerTemplate'      => '<div>foo</div>', // see details above
    'footerTemplate'      => '<div>foo</div>', // see details above
    'scale'               => 1.2,              // defaults to 1.0 (must be a float)
];

// print as pdf (in memory binaries)
$pdf = $page->pdf($options);

// save the pdf
$pdf->saveToFile('/some/place/file.pdf');

// or directly output pdf without saving
header('Content-Description: File Transfer');
header('Content-Type: application/pdf');
header('Content-Disposition: inline; filename=filename.pdf');
header('Content-Transfer-Encoding: binary');
header('Expires: 0');
header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
header('Pragma: public');

echo base64_decode($pdf->getBase64());
```

Options `headerTemplate` and `footerTemplate`:

Should be valid HTML markup with the following classes used to inject printing values into them:
- date: formatted print date
- title: document title
- url: document location
- pageNumber: current page number
- totalPages: total pages in the document

### Save downloads

You can set the path to save downloaded files.

```php
// After creating a page.
$page->setDownloadPath('/path/to/save/downloaded/files');
```

### Mouse API

The mouse API is dependent on the page instance and allows you to control the mouse's moves, clicks and scroll.

```php
$page->mouse()
    ->move(10, 20)                             // Moves mouse to position x=10; y=20
    ->click()                                  // left-click on position set above
    ->move(100, 200, ['steps' => 5])           // move mouse to x=100; y=200 in 5 equal steps
    ->click(['button' => Mouse::BUTTON_RIGHT]; // right-click on position set above

// given the last click was on a link, the next step will wait
// for the page to load after the link was clicked
$page->waitForReload();
```

You can emulate the mouse wheel to scroll up and down in a page, frame, or element.

```php
$page->mouse()
    ->scrollDown(100) // scroll down 100px
    ->scrollUp(50);   // scroll up 50px
```

#### Finding elements

The `find` method will search for elements using [querySelector](https://developer.mozilla.org/docs/Web/API/Document/querySelector) and move the cursor to a random position over it.

```php
try {
    $page->mouse()->find('#a')->click(); // find and click at an element with id "a"

    $page->mouse()->find('.a', 10); // find the 10th or last element with class "a"
} catch (ElementNotFoundException $exception) {
    // element not found
}
```

This method will attempt to scroll right and down to bring the element to the visible screen. If the element is inside an internal scrollable section, try moving the mouse to inside that section first.

### Keyboard API

The keyboard API is dependent on the page instance and allows you to type like a real user.

```php
$page->keyboard()
    ->typeRawKey('Tab') // type a raw key, such as Tab
    ->typeText('bar');  // type the text "bar"
```

To impersonate a real user you may want to add a delay between each keystroke using the ```setKeyInterval``` method:

```php
$page->keyboard()->setKeyInterval(10); // sets a delay of 10 milliseconds between keystrokes
```

#### Key combinations

The methods `press`, `type`, and `release` can be used to send key combinations such as `ctrl + v`.

```php
// ctrl + a to select all text
$page->keyboard()
    ->press('control') // key names are case insensitive and trimmed
        ->type('a')    // press and release
    ->release('Control');

// ctrl + c to copy and ctrl + v to paste it twice
$page->keyboard()
    ->press('Ctrl') // alias for Control
        ->type('c')
        ->type('V') // upper and lower cases should behave the same way
    ->release();    // release all
```

You can press the same key several times in sequence, this is the equivalent to a user pressing and holding the key. The release event, however, will be sent only once per key.

#### Key aliases

| Key     | Aliases                  |
|---------|--------------------------|
| Control | `Control`, `Ctrl`, `Ctr` |
| Alt     | `Alt`, `AltGr`, `Alt Gr` |
| Meta    | `Meta`, `Command`, `Cmd` |
| Shift   | `Shift`                  |

### Cookie API

You can set and get cookies for a page:

#### Set Cookie

```php
use HeadlessChromium\Cookies\Cookie;

$page = $browser->createPage();

// example 1: set cookies for a given domain

$page->setCookies([
    Cookie::create('name', 'value', [
        'domain' => 'example.com',
        'expires' => time() + 3600 // expires in 1 hour
    ])
])->await();


// example 2: set cookies for the current page

$page->navigate('http://example.com')->waitForNavigation();

$page->setCookies([
    Cookie::create('name', 'value', ['expires'])
])->await();
```

#### Get Cookies

```php
use HeadlessChromium\Cookies\Cookie;

$page = $browser->createPage();

// example 1: get all cookies for the browser

$cookies = $page->getAllCookies();

// example 2: get cookies for the current page

$page->navigate('http://example.com')->waitForNavigation();
$cookies = $page->getCookies();

// filter cookies with name == 'foo'
$cookiesFoo = $cookies->filterBy('name', 'foo');

// find first cookie with name == 'bar'
$cookieBar = $cookies->findOneBy('name', 'bar');
if ($cookieBar) {
    // do something
}
```

### Set user agent

You can set up a user-agent per page:

```php
$page->setUserAgent('my user-agent');
```

See also BrowserFactory option ``userAgent`` to set up it for the whole browser.


Advanced usage
--------------

The library ships with tools that hide all the communication logic but you can use the tools used internally to
communicate directly with chrome debug protocol.

Example:

```php
use HeadlessChromium\Communication\Connection;
use HeadlessChromium\Communication\Message;

// chrome devtools URI
$webSocketUri = 'ws://127.0.0.1:9222/devtools/browser/xxx';

// create a connection
$connection = new Connection($webSocketUri);
$connection->connect();

// send method "Target.activateTarget"
$responseReader = $connection->sendMessage(new Message('Target.activateTarget', ['targetId' => 'xxx']));

// wait up to 1000ms for a response
$response = $responseReader->waitForResponse(1000);
```

### Create a session and send a message to the target

```php
// given a target id
$targetId = 'yyy';

// create a session for this target (attachToTarget)
$session = $connection->createSession($targetId);

// send message to this target (Target.sendMessageToTarget)
$response = $session->sendMessageSync(new Message('Page.reload'));
```

### Debugging

You can ease the debugging by setting a delay before each operation is made:

```php
  $connection->setConnectionDelay(500); // wait for 500ms between each operation to ease debugging
```

### Browser (standalone)

```php
use HeadlessChromium\Communication\Connection;
use HeadlessChromium\Browser;

// chrome devtools URI
$webSocketUri = 'ws://127.0.0.1:9222/devtools/browser/xxx';

// create connection given a WebSocket URI
$connection = new Connection($webSocketUri);
$connection->connect();

// create browser
$browser = new Browser($connection);
```

### Interacting with DOM

Find one element on a page by CSS selector:

```php
$page = $browser->createPage();
$page->navigate('http://example.com')->waitForNavigation();

$elem = $page->dom()->querySelector('#index_email');
```

Find all elements inside another element by CSS selector:

```php
$elem = $page->dom()->querySelector('#index_email');
$elem->querySelectorAll('a.link');
```

Find all elements on a page by XPath selector:

```php
$page = $browser->createPage();
$page->navigate('http://example.com')->waitForNavigation();

$elem = $page->dom()->search('//div/*/a');
```

You can send out a text to an element or click on it:

```php
$elem->click();
$elem->sendKeys('Sample text');
```

You can upload file to file from the input:

```php
$elem->sendFile('/path/to/file');
```

You can get element text or attribute:

```php
$text = $elem->getText();
$attr = $elem->getAttribute('class');
```


## Contributing

See [CONTRIBUTING.md](.github/CONTRIBUTING.md) for contribution details.


## License

This project is licensed under the [The MIT License (MIT)](LICENSE).

# flosman.ru-chrome-php-
